<head><title>Tera 24h Clock (alpha 0.7.1)</title>
<script>
// data from enmasse(c) welcome window
var nexusUTC = [
[2, 9, 19],
[2, 19],
[2],
[2],
[],
[2, 19],
[2, 9, 19]
];
var alliancePVP = [
[0, 1, 2, 3, 4, 5, 11, 12, 15, 16, 22, 23],
[0, 1, 2, 3, 4, 5, 11, 12, 15, 16, 22, 23],
[0, 4, 5, 11, 12, 15, 16, 19, 20, 22, 23],
[0, 4, 5, 11, 12, 15, 16, 19, 20, 22, 23],
[0, 1, 2, 3, 4, 5, 11, 12, 15, 16, 19, 20, 22, 23],
[0, 4, 5, 11, 12, 15, 16, 22, 23],
[0, 4, 5, 11, 12, 15, 16, 22, 23]
];
var alliancePVE = [
[0, 3, 4, 11, 12, 14, 15, 18, 22, 23],
[0, 1, 3, 4, 11, 12, 14, 15, 18, 19, 22, 23],
[0, 3, 4, 11, 12, 14, 15, 18, 19, 22, 23],
[0, 3, 4, 11, 12, 14, 15, 18, 19, 22, 23],
[0, 3, 4, 11, 12, 14, 15, 18, 19, 22, 23],
[0, 3, 4, 11, 12, 14, 15, 18, 22, 23],
[0, 3, 4, 11, 12, 14, 15, 18, 22, 23]
];
//end of data;
addEventListener('load',function(){
	document.body.style.cssText="background-color:#fff;margin:0;padding:0;";
	
	
	g_canv = document.createElement("canvas");
	g_cont = g_canv.getContext('2d');
	g_canv.width = CLOCK_WIDTH;
	g_canv.height = CLOCK_HEIGHT;
	document.body.appendChild(g_canv);
	
	grd_nexus = g_cont.createRadialGradient(CLOCK_CENTER_X, CLOCK_CENTER_Y, 30, CLOCK_CENTER_X, CLOCK_CENTER_Y, CLOCK_CENTER_X);;
	grd_nexus.addColorStop(.0, 'rgba(0,0,0,0)');
	grd_nexus.addColorStop(.3, '#000');   
	
	create_clock();
	setInterval(clock_tick,50);
});
var g_canv,g_cont;

var CLOCK_WIDTH = 700,
	CLOCK_HEIGHT = 700,
	CLOCK_CENTER_X = CLOCK_WIDTH    / 2,	
	CLOCK_CENTER_Y = CLOCK_HEIGHT    / 2;
var g_date;
var grd_nexus;
function create_clock() {
	
	//outer/global circle
	g_cont.lineWidth =1;
	g_cont.strokeStyle = "#000";
	g_cont.beginPath();
	g_cont.arc(CLOCK_CENTER_X, CLOCK_CENTER_Y, CLOCK_WIDTH * .495,0, 2 * Math.PI, false);
	g_cont.fillStyle = '#fafafa';
	g_cont.fill();
	g_cont.stroke();
	
	//center circle
	g_cont.beginPath();	
	g_cont.arc(CLOCK_CENTER_X, CLOCK_CENTER_Y, 15,0, 2 * Math.PI, false);
	//g_cont.stroke();
	
	//hours(mark)
	/*
	var r1 = CLOCK_CENTER_Y.21,
		r2 = r1 - 10;
	g_cont.lineJoin = 'round';
	for(var i=0,x,y,a;i<12;i+=1) {
		g_cont.beginPath();
		a = Math.PI / 6 * (i);
		x = CLOCK_CENTER_X  + r1 * Math.cos(a);
		y = CLOCK_CENTER_Y + r1 * Math.sin(a);
		g_cont.moveTo(x, y);
		x = CLOCK_CENTER_X  + r2 * Math.cos(a);
		y = CLOCK_CENTER_Y + r2 * Math.sin(a);
		g_cont.lineTo(x, y);
		g_cont.stroke();
	}*/
	
	g_date = new Date();
	
	create_spiral();
	var day_of_week = g_date.getUTCDay();
	var next_day = (day_of_week==6 ? 0:day_of_week);
	for(var i=0;i<nexusUTC.length;i++) {
		//mark_spiral_hour(nexusUTC[day_of_week][i] - Math.round(g_date.getTimezoneOffset()/60),'nexus');
		//mark_spiral_hour(nexusUTC[next_day][i] - Math.round(g_date.getTimezoneOffset()/60) +24,'nexus');
	}
	for(var i=0;i<48;i++) {	
		mark_spiral_hour(i,'nexus');
	}
	for(var i=0;i<alliancePVE.length;i++) {	
		mark_spiral_hour(alliancePVE[day_of_week][i] - Math.round(g_date.getTimezoneOffset()/60),'pvp');
		mark_spiral_hour(alliancePVE[next_day][i] - Math.round(g_date.getTimezoneOffset()/60) +24,'pvp');
	}
	
	//draw_spiral_arrow_hour();
	/*
	g_cont.beginPath();
	g_cont.moveTo(99, 150);
	g_cont.lineTo(149, 50);
	g_cont.lineTo(199, 150);
	g_cont.lineJoin = 'miter';
	g_cont.stroke();*/
}
function get_spiral_coord(_angle,_radius_offset) {
	var a = (450 + _angle) * Math.PI / 180,
		_r = CLOCK_WIDTH/50;
	return {
		x: CLOCK_WIDTH  / 2 + _r * (a + _radius_offset) * (Math.cos(a-Math.PI) ),
		y: CLOCK_CENTER_Y + _r * (a + _radius_offset) * (Math.sin(a-Math.PI) )
	};
}
function get_spiral_coord2(_angle,_radius_offset) {
	var date = new Date();
	var angle_spiral = ( 90 + _angle) * Math.PI / 180;
	var angle_rotate = (date.getSeconds()  + date.getMilliseconds()/1000 ) *6 * Math.PI / 180  ,
		_r = CLOCK_WIDTH/70;
	var x,y,o;
	angle_spiral -= angle_rotate;
	x = _r * (angle_spiral + _radius_offset) * (Math.cos(angle_spiral-Math.PI) );
	y = _r * (angle_spiral + _radius_offset) * (Math.sin(angle_spiral-Math.PI) );
	o = {
		x:CLOCK_CENTER_X + x * Math.cos(angle_rotate) - y * Math.sin(angle_rotate),
		y:CLOCK_CENTER_Y + x * Math.sin(angle_rotate) + y * Math.cos(angle_rotate)
	};
	return o;
}
function draw_spiral_arrow_hour() {
	g_cont.lineWidth =1;
	g_cont.strokeStyle = "#ccc";
	g_cont.fillStyle = "rgba(255,255,255,.6)";
	g_cont.beginPath();
	//g_cont.moveTo(CLOCK_CENTER_X, CLOCK_CENTER_Y);
	var date = new Date();
	var coord;
	//(date.getHours()  + date.getMinutes()/60 ) * 30
	var hmins = (date.getSeconds()  + date.getMilliseconds()/1000 ) *6 - 360;
	//console.log(hmins);
	for(var i=hmins;i<=hmins+360;i+=5) {
		coord = get_spiral_coord2(  i , Math.PI);
		if(i==0) {
			g_cont.moveTo(coord.x,coord.y);
		}
		g_cont.lineTo(coord.x,coord.y);
	}
	//g_cont.lineTo(coord.x,coord.y);
	//g_cont.lineJoin = 'miter';
	g_cont.closePath();
	g_cont.stroke();
	g_cont.fill();
}
function draw_spiral_arrow_second() {

	g_cont.lineWidth =1;

	//g_cont.fillStyle = "rgba(255,255,255,.7)";
	g_cont.beginPath();
	var date = new Date();
	var coord;
	var angle = (date.getSeconds()  + date.getMilliseconds()/1000  ) * 6;
	var ang_hours = (date.getHours()  + date.getMinutes()/60 ) * 30;
	if(ang_hours >= 360) {
		angle += 360;
	}
	if(angle >= ang_hours) {
		angle -= 360;
	}
	
	coord = {
			x:CLOCK_WIDTH  / 2 + 15*Math.cos(Math.PI*(angle / 180-.5)),
			y:CLOCK_CENTER_Y + 15*Math.sin(Math.PI*(angle / 180-.5))};
	g_cont.moveTo(coord.x,coord.y);
	coord = get_spiral_coord(  angle , Math.PI);
	g_cont.lineTo(coord.x,coord.y);
	/*var r2 = Math.sqrt(Math.pow(CLOCK_CENTER_X - coord.x,2) + Math.pow(CLOCK_CENTER_Y - coord.y,2));
	grd_second = g_cont.createRadialGradient(CLOCK_CENTER_X, CLOCK_CENTER_Y, 10, CLOCK_CENTER_X, CLOCK_CENTER_Y, r2);;
	grd_second.addColorStop(.0, 'rgba(0,0,0,0)');
	grd_second.addColorStop(.3, '#000');
	grd_second.addColorStop(.8, '#000');
	grd_second.addColorStop(1, 'rgba(0,0,0,0)');
	g_cont.strokeStyle = grd_second;*/
	g_cont.stroke();
}
function create_spiral() {
	var _r = 10;
	g_cont.lineWidth = 1;
	g_cont.strokeStyle = "#ddd";
	
	var step = 5;
	var date = new Date();
	var da = (date.getSeconds()  + date.getMilliseconds()/1000  ) * 6;
	for(var i=da,xy;i<=da+360*3;i+=step) {
		xy = get_spiral_coord2(i,0);
		if(i==da){
			g_cont.moveTo(xy.x, xy.y);
		}
	//	console.log(a*180/Math.PI % 90);
		g_cont.lineTo(xy.x, xy.y);
		g_cont.stroke();
	}
}
function mark_spiral_hour(_hour,_type) {

	var date = new Date();
	if(_hour > 37 + date.getSeconds()/5)
		return;
	if(_hour < date.getSeconds()/5) {
		return;
	}
	var _r = 10;
	g_cont.lineWidth = 1;
	
	var step = 5;
	var rx0,rx1;
	if(_type=='nexus') {
		g_cont.strokeStyle = "#05f";
		rx0 = +Math.PI / 1.5;
		rx1 = 0.2;	
		g_cont.fillStyle = "#adf";
	} else if(_type=='pvp') {
		g_cont.strokeStyle = "#f55";
		rx0 = -0.2;
		rx1 = -Math.PI /1.5;
		g_cont.fillStyle = "#fdd";
	}
	var path0=[],
		path1=[];
	for(var i=30*_hour,x0,y0,x1,y2,coord1,coord2;i<=30*(1+_hour);i+=step) {
		coord1 = get_spiral_coord2(i,rx0);
		coord2 = get_spiral_coord2(i,rx1);
		path0.push(coord1);
		path1.push(coord2);
	}
	g_cont.beginPath();
	for(var i=0;i<path0.length;i++) {
		g_cont.lineTo(path0[i].x,path0[i].y);
	}
	for(var i=path1.length-1;i>=0;i--) {
		g_cont.lineTo(path1[i].x,path1[i].y);
	}
	g_cont.closePath();
	//g_cont.stroke();
	g_cont.fill();
}
function clock_tick() {
	create_clock();
	draw_spiral_arrow_hour() ;
	draw_spiral_arrow_second();
}
</script>
</head>